{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block content %}
<div class="module">
    <h1>Referral Details for {{ referrer.username }}</h1>
    
    <div class="results">
        <h2>Summary</h2>
        <table>
            <tr>
                <th>Total Paid Referrals</th>
                <td>k{{ total_paid|floatformat:2 }}</td>
            </tr>
            <tr>
                <th>Total Pending Referrals</th>
                <td style="color: #d9534f; font-weight: bold;">k{{ total_pending|floatformat:2 }}</td>
            </tr>
            <tr>
                <th>Total Referrals</th>
                <td>k{{ total_paid|add:total_pending|floatformat:2 }}</td>
            </tr>
        </table>
    </div>

    <div class="results">
        <h2>Pending Referrals (k{{ total_pending|floatformat:2 }})</h2>
        <table>
            <thead>
                <tr>
                    <th>Referred User</th>
                    <th>Business</th>
                    <th>Amount</th>
                    <th>Created Date</th>
                </tr>
            </thead>
            <tbody>
                {% for referral in pending_referrals %}
                <tr>
                    <td>{{ referral.referred_user.username }}</td>
                    <td>{{ referral.referred_business.name|default:"No Business" }}</td>
                    <td>k{{ referral.amount|floatformat:2 }}</td>
                    <td>{{ referral.created_at|date:"M d, Y" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4">No pending referrals</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="results">
        <h2>Paid Referrals (k{{ total_paid|floatformat:2 }})</h2>
        <table>
            <thead>
                <tr>
                    <th>Referred User</th>
                    <th>Business</th>
                    <th>Amount</th>
                    <th>Created Date</th>
                    <th>Paid Status</th>
                </tr>
            </thead>
            <tbody>
                {% for referral in paid_referrals %}
                <tr>
                    <td>{{ referral.referred_user.username }}</td>
                    <td>{{ referral.referred_business.name|default:"No Business" }}</td>
                    <td>k{{ referral.amount|floatformat:2 }}</td>
                    <td>{{ referral.created_at|date:"M d, Y" }}</td>
                    <td style="color: green;">âœ“ Paid</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No paid referrals</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="submit-row">
        <a href="{% url 'admin:directory_referral_changelist' %}" class="button">Back to Referral List</a>
    </div>
</div>
{% endblock %}